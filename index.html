<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏≠‡∏õ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">
    <script>
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #faf8f0; }
        .dark body { background-color: #1f2937; }
        .calendar-day { position: relative; width: 100%; padding-top: 100%; height: 0; }
        .calendar-day-content { position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 44px; }
        .shift-icon { position: absolute; top: 2px; right: 2px; font-size: 0.6rem; }
        .number-input-buttons { display: flex; align-items: center; }
        .number-input-buttons button { width: 32px; height: 32px; border-radius: 50%; font-weight: bold; }
        .number-input-buttons input { width: 60px; text-align: center; border: 1px solid #ccc; border-radius: 8px; margin: 0 8px; }
        .dark .number-input-buttons input { background-color: #374151; border-color: #4b5563; }
        .summary-table-container::-webkit-scrollbar { height: 8px; }
        .summary-table-container::-webkit-scrollbar-track { background: #f1f1f1; }
        .dark .summary-table-container::-webkit-scrollbar-track { background: #2d3748; }
        .summary-table-container::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
        .dark .summary-table-container::-webkit-scrollbar-thumb { background: #555; }
    </style>
</head>
<body class="text-gray-800 dark:text-gray-200">

    <!-- Login Container -->
    <div id="login-container" class="min-h-screen flex flex-col items-center justify-center text-center p-4 hidden">
        <h1 class="text-4xl font-bold text-amber-700 dark:text-amber-400">‡πÅ‡∏≠‡∏õ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á</h1>
        <p class="mt-2 text-lg text-gray-600 dark:text-gray-300">‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
        <button id="login-btn" class="mt-8 inline-flex items-center gap-3 px-6 py-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
            <svg class="w-6 h-6" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24s8.955,20,20,20s20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.222,0-9.519-3.534-11.082-8.192l-6.823,5.34C9.662,39.631,16.224,44,24,44z"></path><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.574l6.19,5.238C39.901,36.631,44,30.631,44,24C44,22.659,43.862,21.35,43.611,20.083z"></path></svg>
            <span class="font-semibold text-gray-700 dark:text-gray-200">‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏î‡πâ‡∏ß‡∏¢ Google</span>
        </button>
    </div>
    
    <div id="loading-container" class="min-h-screen flex flex-col items-center justify-center text-center p-4">
        <div class="text-gray-600 dark:text-gray-400 flex items-center gap-3">
            <svg class="w-8 h-8 animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
            <span class="text-lg">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ...</span>
        </div>
    </div>


    <!-- Main App Container -->
    <div id="app-container" class="container mx-auto p-2 sm:p-4 max-w-5xl hidden">
        <header class="text-center mb-4 relative">
            <div class="flex justify-center items-center gap-4">
                <img id="user-photo" class="w-10 h-10 rounded-full">
                <div>
                    <h1 id="user-name" class="text-xl font-bold text-amber-700 dark:text-amber-400"></h1>
                    <div class="flex items-center gap-2 text-xs">
                        <p id="auth-status" class="text-gray-500 dark:text-gray-400"></p>
                        <div id="sync-indicator" class="flex items-center gap-1"><span></span><span id="sync-text"></span></div>
                    </div>
                </div>
            </div>
            <div class="absolute top-0 right-0 flex items-center gap-2">
                <button id="settings-btn" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065zM15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg></button>
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700"><svg id="theme-icon-light" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg><svg id="theme-icon-dark" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg></button>
                <button id="logout-btn" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg></button>
            </div>
        </header>

        <!-- Main Content (Calendar, Form, Summary) -->
        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md mb-4">
            <div class="flex justify-between items-center mb-3">
                <button id="prev-month" class="px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600">&lt;</button>
                <h2 id="month-year" class="text-lg font-semibold"></h2>
                <button id="next-month" class="px-3 py-1 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600">&gt;</button>
            </div>
            <div class="grid grid-cols-7 gap-1 text-center text-sm font-medium text-gray-600 dark:text-gray-400 mb-2">
                <div>‡∏≠‡∏≤</div><div>‡∏à</div><div>‡∏≠</div><div>‡∏û</div><div>‡∏û‡∏§</div><div>‡∏®</div><div>‡∏™</div>
            </div>
            <div id="calendar" class="grid grid-cols-7 gap-1"></div>
        </div>

        <div id="entry-form-container" class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md mb-4">
            <h3 class="text-xl font-bold mb-3">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: <span id="selected-date-display" class="text-blue-600 dark:text-blue-400"></span></h3>
            <form id="wage-form">
                <div class="grid grid-cols-2 gap-4 mb-4"><label class="flex items-center p-3 border border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer has-[:checked]:bg-blue-50 has-[:checked]:border-blue-500 dark:has-[:checked]:bg-blue-900/50 dark:has-[:checked]:border-blue-400"><input type="checkbox" id="day-shift" class="mr-2 h-5 w-5 text-blue-600 focus:ring-blue-500 border-gray-300 rounded bg-gray-100 dark:bg-gray-900 dark:border-gray-600"><span>‚òÄÔ∏è ‡∏Å‡∏∞‡πÄ‡∏ä‡πâ‡∏≤</span></label><label class="flex items-center p-3 border border-gray-300 dark:border-gray-600 rounded-lg cursor-pointer has-[:checked]:bg-indigo-50 has-[:checked]:border-indigo-500 dark:has-[:checked]:bg-indigo-900/50 dark:has-[:checked]:border-indigo-400"><input type="checkbox" id="night-shift" class="mr-2 h-5 w-5 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded bg-gray-100 dark:bg-gray-900 dark:border-gray-600"><span>üåô ‡∏Å‡∏∞‡∏î‡∏∂‡∏Å (+100)</span></label></div>
                <div class="grid grid-cols-3 gap-2 sm:gap-4 mb-4 text-center"><div class="bg-gray-100 dark:bg-gray-700 p-2 rounded-lg"><p class="text-sm text-gray-500 dark:text-gray-400">‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á</p><p id="display-wage" class="font-semibold">0</p></div><div class="bg-gray-100 dark:bg-gray-700 p-2 rounded-lg"><p class="text-sm text-gray-500 dark:text-gray-400">‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</p><p id="display-travel" class="font-semibold">0</p></div><div class="bg-gray-100 dark:bg-gray-700 p-2 rounded-lg"><p class="text-sm text-gray-500 dark:text-gray-400">‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£</p><p id="display-meal" class="font-semibold">0</p></div></div>
                <div class="space-y-3 mb-4"><h4 class="font-semibold border-b border-gray-200 dark:border-gray-600 pb-1">‡∏Ñ‡πà‡∏≤‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß</h4><div class="grid grid-cols-2 sm:grid-cols-3 gap-4 pt-2"><div class="flex flex-col items-center"><label for="sht-trips" class="text-sm font-medium mb-1">SHT (<span class="rate-sht">20</span>/‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß)</label><div class="number-input-buttons"><button type="button" data-field="sht-trips" data-step="-0.5" class="step-btn bg-red-200 text-red-700">-</button><input type="number" id="sht-trips" step="0.5" min="0" class="form-input" placeholder=""><button type="button" data-field="sht-trips" data-step="0.5" class="step-btn bg-green-200 text-green-700">+</button></div></div><div class="flex flex-col items-center"><label for="a1pl-trips" class="text-sm font-medium mb-1">A1 P/L (<span class="rate-a1pl1">60</span>/<span class="rate-a1pl2">80</span>/<span class="rate-a1pl3">180</span>)</label><div class="number-input-buttons"><button type="button" data-field="a1pl-trips" data-step="-1" class="step-btn bg-red-200 text-red-700">-</button><input type="number" id="a1pl-trips" step="1" min="0" class="form-input" placeholder=""><button type="button" data-field="a1pl-trips" data-step="1" class="step-btn bg-green-200 text-green-700">+</button></div></div><div class="flex flex-col items-center"><label for="gw-trips" class="text-sm font-medium mb-1">G/W (<span class="rate-gw">180</span>/‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß)</label><div class="number-input-buttons"><button type="button" data-field="gw-trips" data-step="-1" class="step-btn bg-red-200 text-red-700">-</button><input type="number" id="gw-trips" step="1" min="0" class="form-input" placeholder=""><button type="button" data-field="gw-trips" data-step="1" class="step-btn bg-green-200 text-green-700">+</button></div></div><div class="flex flex-col items-center"><label for="kd-trips" class="text-sm font-medium mb-1">KD (<span class="rate-kd">180</span>/‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß)</label><div class="number-input-buttons"><button type="button" data-field="kd-trips" data-step="-1" class="step-btn bg-red-200 text-red-700">-</button><input type="number" id="kd-trips" step="1" min="0" class="form-input" placeholder=""><button type="button" data-field="kd-trips" data-step="1" class="step-btn bg-green-200 text-green-700">+</button></div></div><div class="flex flex-col items-center"><label for="tru-trips" class="text-sm font-medium mb-1">TRU (<span class="rate-tru">140</span>/‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß)</label><div class="number-input-buttons"><button type="button" data-field="tru-trips" data-step="-1" class="step-btn bg-red-200 text-red-700">-</button><input type="number" id="tru-trips" step="1" min="0" class="form-input" placeholder=""><button type="button" data-field="tru-trips" data-step="1" class="step-btn bg-green-200 text-green-700">+</button></div></div><div class="flex flex-col items-center"><label for="dmet-trips" class="text-sm font-medium mb-1">DMET (<span class="rate-dmet">140</span>/‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß)</label><div class="number-input-buttons"><button type="button" data-field="dmet-trips" data-step="-1" class="step-btn bg-red-200 text-red-700">-</button><input type="number" id="dmet-trips" step="1" min="0" class="form-input" placeholder=""><button type="button" data-field="dmet-trips" data-step="1" class="step-btn bg-green-200 text-green-700">+</button></div></div></div></div>
                <div class="space-y-3 mb-4"><h4 class="font-semibold border-b border-gray-200 dark:border-gray-600 pb-1">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏≠‡∏∑‡πà‡∏ô‡πÜ</h4><div class="grid grid-cols-2 sm:grid-cols-3 gap-4 pt-2"><div><label for="ot-pre" class="block text-sm font-medium">‡∏Ñ‡πà‡∏≤‡πÇ‡∏≠‡∏ó‡∏µ‡∏´‡∏ô‡πâ‡∏≤</label><input type="number" id="ot-pre" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600"></div><div><label for="other-trips-pay" class="block text-sm font-medium">‡∏Ñ‡πà‡∏≤‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏≠‡∏∑‡πà‡∏ô‡πÜ</label><input type="number" id="other-trips-pay" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600"></div><div><label for="ot-post" class="block text-sm font-medium">‡∏Ñ‡πà‡∏≤‡πÇ‡∏≠‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á</label><input type="number" id="ot-post" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600"></div><div><label for="special-meal" class="block text-sm font-medium">‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©</label><input type="number" id="special-meal" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600"></div><div><label for="night-shift-pay" class="block text-sm font-medium">‡∏Ñ‡πà‡∏≤‡∏Å‡∏∞‡∏î‡∏∂‡∏Å</label><input type="number" id="night-shift-pay" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600"></div><div><label for="diligence-bonus" class="block text-sm font-medium">‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏Ç‡∏¢‡∏±‡∏ô</label><input type="number" id="diligence-bonus" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600"></div></div><div><label for="other-trips-details" class="block text-sm font-medium">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏ß‡∏¥‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ</label><textarea id="other-trips-details" rows="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600"></textarea></div></div>
                <div class="mt-6 p-4 bg-blue-50 dark:bg-gray-700/50 rounded-lg flex flex-col sm:flex-row justify-between items-center gap-4"><div class="text-center"><p class="text-lg">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p><p id="total-today" class="text-3xl font-bold text-blue-700 dark:text-blue-400">0.00 ‡∏ö‡∏≤‡∏ó</p></div><div class="flex flex-wrap justify-center gap-2"><button type="submit" id="save-btn" class="px-6 py-2 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button><button type="button" id="clear-btn" class="px-4 py-2 bg-gray-500 text-white font-semibold rounded-lg shadow-md hover:bg-gray-600">‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå</button><button type="button" id="delete-btn" class="px-4 py-2 bg-red-600 text-white font-semibold rounded-lg shadow-md hover:bg-red-700">‡∏•‡∏ö</button></div></div>
            </form>
        </div>

        <div class="bg-white dark:bg-gray-800 p-4 rounded-lg shadow-md">
            <h3 class="text-xl font-bold mb-3">‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î</h3>
            <div class="flex border-b border-gray-200 dark:border-gray-600 mb-3">
                <button data-period="1" class="period-tab flex-1 py-2 text-center border-b-2 border-blue-500 text-blue-600 dark:text-blue-400 font-semibold">‡∏£‡∏≠‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 1-15</button>
                <button data-period="2" class="period-tab flex-1 py-2 text-center border-transparent text-gray-500 dark:text-gray-400">‡∏£‡∏≠‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 16-‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
            </div>
            
            <div class="relative my-4">
                <input type="text" id="search-input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (dd/mm/yyyy) ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î..." class="w-full pl-10 pr-4 py-2 border rounded-lg dark:bg-gray-700 dark:border-gray-600">
                <svg class="w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            </div>

            <div id="summary-content">
                <div class="summary-table-container overflow-x-auto mb-4">
                    <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-600 text-xs">
                        <thead class="bg-gray-50 dark:bg-gray-700/50">
                            <tr>
                                <th class="px-2 py-2 text-left font-medium text-gray-500 dark:text-gray-400 uppercase">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                <th class="px-2 py-2 text-center font-medium text-gray-500 dark:text-gray-400 uppercase">‡∏Å‡∏∞</th>
                                <th class="px-2 py-2 text-right font-medium text-gray-500 dark:text-gray-400 uppercase">‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</th>
                                <th class="px-2 py-2 text-right font-medium text-gray-500 dark:text-gray-400 uppercase">‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß</th>
                                <th class="px-2 py-2 text-right font-medium text-gray-500 dark:text-gray-400 uppercase">‡πÇ‡∏≠‡∏ó‡∏µ</th>
                                <th class="px-2 py-2 text-right font-medium text-gray-500 dark:text-gray-400 uppercase">‡∏û‡∏¥‡πÄ‡∏®‡∏©</th>
                                <th class="px-2 py-2 text-right font-medium text-gray-500 dark:text-gray-400 uppercase">‡∏£‡∏ß‡∏°</th>
                            </tr>
                        </thead>
                        <tbody id="summary-table-body" class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-600"></tbody>
                    </table>
                </div>
                <div id="category-summary" class="grid grid-cols-2 sm:grid-cols-4 gap-2 text-sm mb-4"></div>
                <div class="mt-4 p-4 bg-green-50 dark:bg-green-900/50 rounded-lg text-center">
                    <p class="text-lg">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</p>
                    <p id="grand-total" class="text-3xl font-bold text-green-700 dark:text-green-400">0.00 ‡∏ö‡∏≤‡∏ó</p>
                </div>
                <div class="flex justify-center gap-2 mt-4">
                     <button id="print-btn" class="px-4 py-2 bg-teal-500 text-white font-semibold rounded-lg shadow-md hover:bg-teal-600">‡∏õ‡∏£‡∏¥‡πâ‡∏ô</button>
                     <button id="backup-btn" class="px-4 py-2 bg-purple-500 text-white font-semibold rounded-lg shadow-md hover:bg-purple-600">‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals (Delete, Settings) -->
    <div id="delete-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50"><div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white dark:bg-gray-800 dark:border-gray-700"><div class="mt-3 text-center"><div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 dark:bg-red-900/50"><svg class="h-6 w-6 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg></div><h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö</h3><div class="mt-2 px-7 py-3"><p class="text-sm text-gray-500 dark:text-gray-400">‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà <span id="delete-date-confirm"></span>?</p></div><div class="items-center px-4 py-3"><button id="confirm-delete-btn" class="px-4 py-2 bg-red-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-red-600">‡∏•‡∏ö</button><button id="cancel-delete-btn" class="mt-2 px-4 py-2 bg-gray-200 text-gray-800 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500 text-base font-medium rounded-md w-full shadow-sm hover:bg-gray-300">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button></div></div></div></div>
    <div id="settings-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 overflow-y-auto h-full w-full hidden z-50"><div class="relative top-10 mx-auto p-5 border w-full max-w-lg shadow-lg rounded-md bg-white dark:bg-gray-800 dark:border-gray-700"><form id="settings-form"><h3 class="text-xl font-bold mb-4">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á</h3><div class="space-y-4 max-h-[70vh] overflow-y-auto pr-2"><h4 class="font-semibold border-b pb-1 dark:border-gray-600">‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</h4><div class="grid grid-cols-3 gap-4"><div><label class="block text-sm">‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á</label><input type="number" id="setting-wage" class="mt-1 w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600"></div><div><label class="block text-sm">‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</label><input type="number" id="setting-travel" class="mt-1 w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600"></div><div><label class="block text-sm">‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£</label><input type="number" id="setting-meal" class="mt-1 w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600"></div></div><h4 class="font-semibold border-b pb-1 dark:border-gray-600">‡∏Ñ‡πà‡∏≤‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß</h4><div class="grid grid-cols-2 sm:grid-cols-3 gap-4"><div><label class="block text-sm">SHT</label><input type="number" step="0.5" id="setting-sht" class="mt-1 w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600"></div><div><label class="block text-sm">A1 P/L (1)</label><input type="number" id="setting-a1pl1" class="mt-1 w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600"></div><div><label class="block text-sm">A1 P/L (2)</label><input type="number" id="setting-a1pl2" class="mt-1 w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600"></div><div><label class="block text-sm">A1 P/L (3+)</label><input type="number" id="setting-a1pl3" class="mt-1 w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600"></div><div><label class="block text-sm">G/W</label><input type="number" id="setting-gw" class="mt-1 w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600"></div><div><label class="block text-sm">KD</label><input type="number" id="setting-kd" class="mt-1 w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600"></div><div><label class="block text-sm">TRU</label><input type="number" id="setting-tru" class="mt-1 w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600"></div><div><label class="block text-sm">DMET</label><input type="number" id="setting-dmet" class="mt-1 w-full rounded-md border-gray-300 shadow-sm dark:bg-gray-700 dark:border-gray-600"></div></div></div><div class="flex justify-end gap-2 mt-6"><button type="button" id="cancel-settings-btn" class="px-4 py-2 bg-gray-200 text-gray-800 dark:bg-gray-600 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-500">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button><button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></div></form></div></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithRedirect, getRedirectResult, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, deleteDoc, onSnapshot, collection, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : { apiKey: "YOUR_API_KEY", authDomain: "YOUR_AUTH_DOMAIN", projectId: "YOUR_PROJECT_ID" };
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-wage-app';

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        let currentUserId = null;
        let currentDate = new Date();
        let selectedDate = new Date().toISOString().split('T')[0];
        let wageData = {};
        let currentPeriod = 1;
        let settings = {};
        let unsubscribe = null;

        const defaultSettings = {
            baseWage: 372, travel: 60, meal: 50,
            tripRates: { sht: 20, a1pl1: 60, a1pl2: 80, a1pl3: 180, gw: 180, kd: 180, tru: 140, dmet: 140 }
        };

        const loginContainer = document.getElementById('login-container');
        const appContainer = document.getElementById('app-container');
        const loadingContainer = document.getElementById('loading-container');
        const form = document.getElementById('wage-form');
        
        // --- Authentication ---
        onAuthStateChanged(auth, (user) => {
            loadingContainer.classList.add('hidden');
            if (user) {
                currentUserId = user.uid;
                loginContainer.classList.add('hidden');
                appContainer.classList.remove('hidden');
                
                document.getElementById('user-name').textContent = user.displayName;
                document.getElementById('user-photo').src = user.photoURL;
                document.getElementById('auth-status').textContent = user.email;

                initializeAppState();
            } else {
                currentUserId = null;
                if (unsubscribe) unsubscribe();
                wageData = {};
                appContainer.classList.add('hidden');
                loginContainer.classList.remove('hidden');
            }
        });

        // Check for redirect result on page load
        getRedirectResult(auth).catch((error) => {
            console.error("Error getting redirect result:", error);
            // Hide loading and show login even if there's an error
            loadingContainer.classList.add('hidden');
            loginContainer.classList.remove('hidden');
        });


        async function signInWithGoogle() {
            const provider = new GoogleAuthProvider();
            await signInWithRedirect(auth, provider);
        }

        async function signOutUser() {
            await signOut(auth);
        }

        // --- Main App Initialization ---
        function initializeAppState() {
            if (!currentUserId) return;
            if (unsubscribe) unsubscribe();

            loadSettings();
            updateSyncStatus('connecting', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...');
            const wagesCollectionRef = collection(db, `artifacts/${appId}/users/${currentUserId}/wages`);
            unsubscribe = onSnapshot(query(wagesCollectionRef), (snapshot) => {
                snapshot.docChanges().forEach((change) => {
                    if (change.type === "added" || change.type === "modified") wageData[change.doc.id] = change.doc.data();
                    if (change.type === "removed") delete wageData[change.doc.id];
                });
                renderCalendar();
                updateSummary();
                updateSyncStatus('synced', '‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß');
            }, (error) => {
                updateSyncStatus('error', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î');
            });

            renderCalendar();
            setSelectedDate(selectedDate);
            addEventListenersOnce(); 
        }
        
        // --- Settings Logic ---
        function loadSettings() {
            const savedSettings = localStorage.getItem(`wageSettings-${currentUserId}`);
            settings = savedSettings ? JSON.parse(savedSettings) : defaultSettings;
            updateSettingsUI();
        }

        function saveSettings() {
            settings = {
                baseWage: parseFloat(document.getElementById('setting-wage').value) || 0,
                travel: parseFloat(document.getElementById('setting-travel').value) || 0,
                meal: parseFloat(document.getElementById('setting-meal').value) || 0,
                tripRates: {
                    sht: parseFloat(document.getElementById('setting-sht').value) || 0,
                    a1pl1: parseFloat(document.getElementById('setting-a1pl1').value) || 0,
                    a1pl2: parseFloat(document.getElementById('setting-a1pl2').value) || 0,
                    a1pl3: parseFloat(document.getElementById('setting-a1pl3').value) || 0,
                    gw: parseFloat(document.getElementById('setting-gw').value) || 0,
                    kd: parseFloat(document.getElementById('setting-kd').value) || 0,
                    tru: parseFloat(document.getElementById('setting-tru').value) || 0,
                    dmet: parseFloat(document.getElementById('setting-dmet').value) || 0,
                }
            };
            localStorage.setItem(`wageSettings-${currentUserId}`, JSON.stringify(settings));
            updateSettingsUI();
            calculateTotal();
        }

        function updateSettingsUI() {
            document.getElementById('display-wage').textContent = `${settings.baseWage} ‡∏ö‡∏≤‡∏ó`;
            document.getElementById('display-travel').textContent = `${settings.travel} ‡∏ö‡∏≤‡∏ó`;
            document.getElementById('display-meal').textContent = `${settings.meal} ‡∏ö‡∏≤‡∏ó`;
            document.querySelector('.rate-sht').textContent = settings.tripRates.sht;
            document.querySelector('.rate-a1pl1').textContent = settings.tripRates.a1pl1;
            document.querySelector('.rate-a1pl2').textContent = settings.tripRates.a1pl2;
            document.querySelector('.rate-a1pl3').textContent = settings.tripRates.a1pl3;
            document.querySelector('.rate-gw').textContent = settings.tripRates.gw;
            document.querySelector('.rate-kd').textContent = settings.tripRates.kd;
            document.querySelector('.rate-tru').textContent = settings.tripRates.tru;
            document.querySelector('.rate-dmet').textContent = settings.tripRates.dmet;

            document.getElementById('setting-wage').value = settings.baseWage;
            document.getElementById('setting-travel').value = settings.travel;
            document.getElementById('setting-meal').value = settings.meal;
            document.getElementById('setting-sht').value = settings.tripRates.sht;
            document.getElementById('setting-a1pl1').value = settings.tripRates.a1pl1;
            document.getElementById('setting-a1pl2').value = settings.tripRates.a1pl2;
            document.getElementById('setting-a1pl3').value = settings.tripRates.a1pl3;
            document.getElementById('setting-gw').value = settings.tripRates.gw;
            document.getElementById('setting-kd').value = settings.tripRates.kd;
            document.getElementById('setting-tru').value = settings.tripRates.tru;
            document.getElementById('setting-dmet').value = settings.tripRates.dmet;
        }

        // --- Search Logic ---
        function filterData(query) {
            if (!query) return null;
            query = query.toLowerCase().trim();
            
            let searchDate = null;
            if (query.match(/^\d{1,2}\/\d{1,2}\/\d{4}$/)) {
                const parts = query.split('/');
                searchDate = `${parts[2]}-${parts[1].padStart(2, '0')}-${parts[0].padStart(2, '0')}`;
            }

            return Object.values(wageData).filter(d => {
                const details = d.additional?.otherTripsDetails?.toLowerCase() || '';
                if (searchDate) {
                    return d.date === searchDate;
                }
                return details.includes(query);
            });
        }

        // --- Summary Logic ---
        function updateSummary(filteredData = null) {
            const searchInput = document.getElementById('search-input');
            const query = searchInput.value;
            const dataToDisplay = filteredData || (query ? filterData(query) : null);

            let periodData;

            if (dataToDisplay) {
                periodData = dataToDisplay.sort((a, b) => new Date(a.date) - new Date(b.date));
            } else {
                const [year, month] = selectedDate.split('-').map(Number);
                const startDate = currentPeriod === 1 ? 1 : 16;
                const endDate = currentPeriod === 1 ? 15 : new Date(year, month, 0).getDate();
                periodData = Object.values(wageData).filter(d => {
                    const recordDate = new Date(d.date + 'T00:00:00');
                    return recordDate.getFullYear() === year && recordDate.getMonth() === (month - 1) && recordDate.getDate() >= startDate && recordDate.getDate() <= endDate;
                }).sort((a, b) => new Date(a.date) - new Date(b.date));
            }

            const tableBody = document.getElementById('summary-table-body');
            tableBody.innerHTML = '';
            let grandTotal = 0;
            let categoryTotals = { base: 0, trips: 0, ot: 0, special: 0 };

            periodData.forEach(d => {
                grandTotal += d.totalPay;
                let shiftIcon = '';
                if (d.shift?.day) shiftIcon += '‚òÄÔ∏è';
                if (d.shift?.night) shiftIcon += 'üåô';
                let basePay = (d.shift?.day || d.shift?.night) ? (settings.baseWage + settings.travel + settings.meal) : 0;
                let tripTotal = ((d.trips.sht || 0) * settings.tripRates.sht) + ((d.trips.gw || 0) * settings.tripRates.gw) + ((d.trips.kd || 0) * settings.tripRates.kd) + ((d.trips.tru || 0) * settings.tripRates.tru) + ((d.trips.dmet || 0) * settings.tripRates.dmet) + (d.additional.otherTripsPay || 0);
                const a1pl = d.trips.a1pl || 0;
                if (a1pl === 1) tripTotal += settings.tripRates.a1pl1; else if (a1pl === 2) tripTotal += settings.tripRates.a1pl1 + settings.tripRates.a1pl2; else if (a1pl >= 3) tripTotal += settings.tripRates.a1pl1 + settings.tripRates.a1pl2 + settings.tripRates.a1pl3 * (a1pl - 2);
                let otTotal = (d.additional.otPre || 0) + (d.additional.otPost || 0);
                let specialTotal = (d.additional.specialMeal || 0) + (d.additional.nightShiftPay || 0) + (d.additional.diligenceBonus || 0);
                
                tableBody.innerHTML += `<tr><td class="px-2 py-2 whitespace-nowrap">${new Date(d.date + 'T00:00:00').toLocaleDateString('th-TH', { day:'2-digit', month:'short' })}</td><td class="px-2 py-2 whitespace-nowrap text-center">${shiftIcon}</td><td class="px-2 py-2 whitespace-nowrap text-right">${basePay.toFixed(2)}</td><td class="px-2 py-2 whitespace-nowrap text-right">${tripTotal.toFixed(2)}</td><td class="px-2 py-2 whitespace-nowrap text-right">${otTotal.toFixed(2)}</td><td class="px-2 py-2 whitespace-nowrap text-right">${specialTotal.toFixed(2)}</td><td class="px-2 py-2 whitespace-nowrap text-right font-semibold">${d.totalPay.toFixed(2)}</td></tr>`;
                categoryTotals.base += basePay; categoryTotals.trips += tripTotal; categoryTotals.ot += otTotal; categoryTotals.special += specialTotal;
            });
            
            if (periodData.length === 0) { tableBody.innerHTML = `<tr><td colspan="7" class="text-center py-4 text-gray-500 dark:text-gray-400">${query ? '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤' : '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ'}</td></tr>`; }
            document.getElementById('grand-total').textContent = `${grandTotal.toFixed(2)} ‡∏ö‡∏≤‡∏ó`;
            document.getElementById('category-summary').innerHTML = `<div class="bg-gray-100 dark:bg-gray-700 p-2 rounded">‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô: <span class="font-semibold float-right">${categoryTotals.base.toFixed(2)}</span></div><div class="bg-gray-100 dark:bg-gray-700 p-2 rounded">‡∏Ñ‡πà‡∏≤‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß: <span class="font-semibold float-right">${categoryTotals.trips.toFixed(2)}</span></div><div class="bg-gray-100 dark:bg-gray-700 p-2 rounded">‡πÇ‡∏≠‡∏ó‡∏µ: <span class="font-semibold float-right">${categoryTotals.ot.toFixed(2)}</span></div><div class="bg-gray-100 dark:bg-gray-700 p-2 rounded">‡∏û‡∏¥‡πÄ‡∏®‡∏©: <span class="font-semibold float-right">${categoryTotals.special.toFixed(2)}</span></div>`;
        }
        
        // --- Event Listeners ---
        let listenersAdded = false;
        function addEventListenersOnce() {
            if (listenersAdded) return;
            document.getElementById('logout-btn').addEventListener('click', signOutUser);
            document.getElementById('prev-month').addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() - 1); renderCalendar(); });
            document.getElementById('next-month').addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() + 1); renderCalendar(); });
            document.getElementById('calendar').addEventListener('click', (e) => { const dayEl = e.target.closest('[data-date]'); if (dayEl) setSelectedDate(dayEl.dataset.date); });
            form.addEventListener('input', calculateTotal);
            document.getElementById('night-shift').addEventListener('change', (e) => { const nightShiftPayInput = document.getElementById('night-shift-pay'); if (e.target.checked) { if (!nightShiftPayInput.value || parseFloat(nightShiftPayInput.value) === 0) nightShiftPayInput.value = 100; } else { if (parseFloat(nightShiftPayInput.value) === 100) nightShiftPayInput.value = ''; } calculateTotal(); });
            document.querySelectorAll('.step-btn').forEach(button => { button.addEventListener('click', () => { const input = document.getElementById(button.dataset.field); let val = parseFloat(input.value) || 0; val += parseFloat(button.dataset.step); input.value = (val < 0) ? 0 : val; calculateTotal(); }); });
            form.addEventListener('submit', (e) => { e.preventDefault(); saveData(); });
            document.getElementById('clear-btn').addEventListener('click', () => { form.reset(); form.querySelectorAll('input[type="number"], textarea').forEach(input => input.value = ''); calculateTotal(); });
            const deleteModal = document.getElementById('delete-modal');
            document.getElementById('delete-btn').addEventListener('click', () => { document.getElementById('delete-date-confirm').textContent = document.getElementById('selected-date-display').textContent; deleteModal.classList.remove('hidden'); });
            document.getElementById('cancel-delete-btn').addEventListener('click', () => deleteModal.classList.add('hidden'));
            document.getElementById('confirm-delete-btn').addEventListener('click', () => { deleteData(); deleteModal.classList.add('hidden'); });
            document.querySelectorAll('.period-tab').forEach(tab => { tab.addEventListener('click', () => { document.querySelector('.period-tab[class*="border-blue-500"]').classList.remove('border-blue-500', 'text-blue-600', 'dark:text-blue-400'); tab.classList.add('border-blue-500', 'text-blue-600', 'dark:text-blue-400'); currentPeriod = parseInt(tab.dataset.period); document.getElementById('search-input').value = ''; updateSummary(); }); });
            document.getElementById('print-btn').addEventListener('click', () => window.print());
            document.getElementById('backup-btn').addEventListener('click', () => { const dataStr = JSON.stringify(wageData, null, 2); const linkElement = document.createElement('a'); linkElement.setAttribute('href', 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr)); linkElement.setAttribute('download', `wage_backup_${new Date().toISOString().split('T')[0]}.json`); linkElement.click(); });
            const themeToggleBtn = document.getElementById('theme-toggle');
            themeToggleBtn.addEventListener('click', () => { const isDark = document.documentElement.classList.toggle('dark'); localStorage.setItem('theme', isDark ? 'dark' : 'light'); updateThemeIcons(isDark); });
            function updateThemeIcons(isDark) { document.getElementById('theme-icon-light').classList.toggle('hidden', isDark); document.getElementById('theme-icon-dark').classList.toggle('hidden', !isDark); }
            updateThemeIcons(document.documentElement.classList.contains('dark'));
            const settingsModal = document.getElementById('settings-modal');
            document.getElementById('settings-btn').addEventListener('click', () => { updateSettingsUI(); settingsModal.classList.remove('hidden'); });
            document.getElementById('cancel-settings-btn').addEventListener('click', () => settingsModal.classList.add('hidden'));
            document.getElementById('settings-form').addEventListener('submit', (e) => { e.preventDefault(); saveSettings(); settingsModal.classList.add('hidden'); });
            document.getElementById('search-input').addEventListener('input', () => updateSummary());
            listenersAdded = true;
        }

        document.getElementById('login-btn').addEventListener('click', () => {
            loginContainer.classList.add('hidden');
            loadingContainer.classList.remove('hidden');
            signInWithGoogle();
        });

        function setSelectedDate(dateStr) { selectedDate = dateStr; document.getElementById('selected-date-display').textContent = new Date(dateStr + 'T00:00:00').toLocaleDateString('th-TH', { day: 'numeric', month: 'long', year: 'numeric' }); loadDataForDate(dateStr); renderCalendar(); }
        function renderCalendar() { const calendarEl = document.getElementById('calendar'); calendarEl.innerHTML = ''; const year = currentDate.getFullYear(); const month = currentDate.getMonth(); document.getElementById('month-year').textContent = `${currentDate.toLocaleString('th-TH', { month: 'long' })} ${year + 543}`; const firstDayOfMonth = new Date(year, month, 1).getDay(); const daysInMonth = new Date(year, month + 1, 0).getDate(); for (let i = 0; i < firstDayOfMonth; i++) { calendarEl.innerHTML += `<div class="calendar-day"></div>`; } for (let day = 1; day <= daysInMonth; day++) { const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`; const today = new Date().toISOString().split('T')[0]; let dayClasses = 'calendar-day-content border rounded-lg cursor-pointer transition-colors '; if (dateStr === selectedDate) dayClasses += 'bg-blue-500 text-white ring-2 ring-blue-300 dark:ring-blue-500'; else if (dateStr === today) dayClasses += 'bg-blue-100 text-blue-700 dark:bg-blue-900/50 dark:text-blue-300'; else dayClasses += 'bg-white dark:bg-gray-800 hover:bg-gray-100 dark:hover:bg-gray-700 border-gray-200 dark:border-gray-700'; let shiftIcon = ''; const dayData = wageData[dateStr]; if (dayData && (dayData.shift?.day || dayData.shift?.night)) { dayClasses += ' border-green-500 bg-green-50 dark:bg-green-900/50 dark:border-green-600'; if (dayData.shift?.day) shiftIcon = '‚òÄÔ∏è'; if (dayData.shift?.night) shiftIcon = 'üåô'; if (dayData.shift?.day && dayData.shift?.night) shiftIcon = '‚òÄÔ∏èüåô'; } const dayEl = document.createElement('div'); dayEl.className = 'calendar-day'; dayEl.innerHTML = `<div class="${dayClasses}" data-date="${dateStr}"><span>${day}</span>${shiftIcon ? `<span class="shift-icon">${shiftIcon}</span>` : ''}</div>`; calendarEl.appendChild(dayEl); } }
        function loadDataForDate(dateStr) { form.reset(); form.querySelectorAll('input[type="number"], textarea').forEach(input => input.value = ''); const data = wageData[dateStr]; if (data) { document.getElementById('day-shift').checked = data.shift?.day || false; document.getElementById('night-shift').checked = data.shift?.night || false; document.getElementById('sht-trips').value = data.trips?.sht || ''; document.getElementById('a1pl-trips').value = data.trips?.a1pl || ''; document.getElementById('gw-trips').value = data.trips?.gw || ''; document.getElementById('kd-trips').value = data.trips?.kd || ''; document.getElementById('tru-trips').value = data.trips?.tru || ''; document.getElementById('dmet-trips').value = data.trips?.dmet || ''; document.getElementById('ot-pre').value = data.additional?.otPre || ''; document.getElementById('other-trips-pay').value = data.additional?.otherTripsPay || ''; document.getElementById('ot-post').value = data.additional?.otPost || ''; document.getElementById('special-meal').value = data.additional?.specialMeal || ''; document.getElementById('night-shift-pay').value = data.additional?.nightShiftPay || ''; document.getElementById('diligence-bonus').value = data.additional?.diligenceBonus || ''; document.getElementById('other-trips-details').value = data.additional?.otherTripsDetails || ''; } calculateTotal(); }
        async function saveData() { if (!currentUserId) { updateSyncStatus('error', '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô'); return; } updateSyncStatus('syncing', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...'); const total = calculateTotal(); const dataToSave = { date: selectedDate, totalPay: total, shift: { day: document.getElementById('day-shift').checked, night: document.getElementById('night-shift').checked }, trips: { sht: parseFloat(document.getElementById('sht-trips').value) || 0, a1pl: parseInt(document.getElementById('a1pl-trips').value) || 0, gw: parseInt(document.getElementById('gw-trips').value) || 0, kd: parseInt(document.getElementById('kd-trips').value) || 0, tru: parseInt(document.getElementById('tru-trips').value) || 0, dmet: parseInt(document.getElementById('dmet-trips').value) || 0, }, additional: { otPre: parseFloat(document.getElementById('ot-pre').value) || 0, otherTripsPay: parseFloat(document.getElementById('other-trips-pay').value) || 0, otPost: parseFloat(document.getElementById('ot-post').value) || 0, specialMeal: parseFloat(document.getElementById('special-meal').value) || 0, nightShiftPay: parseFloat(document.getElementById('night-shift-pay').value) || 0, diligenceBonus: parseFloat(document.getElementById('diligence-bonus').value) || 0, otherTripsDetails: document.getElementById('other-trips-details').value.trim(), } }; const docRef = doc(db, `artifacts/${appId}/users/${currentUserId}/wages`, selectedDate); try { await setDoc(docRef, dataToSave); form.reset(); form.querySelectorAll('input[type="number"], textarea').forEach(input => input.value = ''); calculateTotal(); } catch (error) { updateSyncStatus('error', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); } }
        async function deleteData() { if (!currentUserId) { updateSyncStatus('error', '‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô'); return; } updateSyncStatus('syncing', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...'); const docRef = doc(db, `artifacts/${appId}/users/${currentUserId}/wages`, selectedDate); try { await deleteDoc(docRef); loadDataForDate(selectedDate); } catch (error) { updateSyncStatus('error', '‡∏•‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'); } }
        function calculateTotal() { let total = 0; const isWorking = document.getElementById('day-shift').checked || document.getElementById('night-shift').checked; if (isWorking) { total += settings.baseWage + settings.travel + settings.meal; } total += (parseFloat(document.getElementById('sht-trips').value) || 0) * settings.tripRates.sht; const a1plTrips = parseInt(document.getElementById('a1pl-trips').value) || 0; if (a1plTrips === 1) total += settings.tripRates.a1pl1; else if (a1plTrips === 2) total += settings.tripRates.a1pl1 + settings.tripRates.a1pl2; else if (a1plTrips >= 3) total += settings.tripRates.a1pl1 + settings.tripRates.a1pl2 + settings.tripRates.a1pl3 * (a1plTrips - 2); total += (parseInt(document.getElementById('gw-trips').value) || 0) * settings.tripRates.gw; total += (parseInt(document.getElementById('kd-trips').value) || 0) * settings.tripRates.kd; total += (parseInt(document.getElementById('tru-trips').value) || 0) * settings.tripRates.tru; total += (parseInt(document.getElementById('dmet-trips').value) || 0) * settings.tripRates.dmet; total += parseFloat(document.getElementById('ot-pre').value) || 0; total += parseFloat(document.getElementById('other-trips-pay').value) || 0; total += parseFloat(document.getElementById('ot-post').value) || 0; total += parseFloat(document.getElementById('special-meal').value) || 0; total += parseFloat(document.getElementById('night-shift-pay').value) || 0; total += parseFloat(document.getElementById('diligence-bonus').value) || 0; document.getElementById('total-today').textContent = `${total.toFixed(2)} ‡∏ö‡∏≤‡∏ó`; return total; }
        function updateSyncStatus(status, message) { const icons = { connecting: `<svg class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`, syncing: `<svg class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`, synced: `<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>`, error: `<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>` }; const colors = { connecting: 'text-yellow-600 dark:text-yellow-400', syncing: 'text-blue-600 dark:text-blue-400', synced: 'text-green-600 dark:text-green-400', error: 'text-red-600 dark:text-red-400' }; const syncIndicatorEl = document.getElementById('sync-indicator'); syncIndicatorEl.className = `flex items-center gap-1 text-sm ${colors[status]}`; syncIndicatorEl.firstElementChild.outerHTML = icons[status]; document.getElementById('sync-text').textContent = message; }
    </script>
</body>
</html>